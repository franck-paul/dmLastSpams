"use strict";dotclear.ready(()=>{dotclear.dmLastSpams=dotclear.getData("dm_lastspams");const e=(e,a="toggle",s=null)=>{dotclear.dmViewComment(e,"dmlse",!s.metaKey)},a=e=>{dotclear.services("dmLastSpamsCount",a=>{try{const s=JSON.parse(a);if(!s?.success)return void console.log(dotclear.debug&&s?.message?s.message:"Dotclear REST server error");if(s?.payload.ret){const a=s.payload.nb;void 0!==a&&a!==dotclear.dmLastSpams.spamCount&&(dotclear.badge(e,{id:"dmls",value:a,remove:a<=0,sibling:!0,icon:!0}),dotclear.dmLastSpams.spamCount=a)}}catch(e){console.log(e)}},e=>{console.log(e)},!0,{json:1})},s=()=>{dotclear.services("dmLastSpamsCheck",a=>{try{const t=JSON.parse(a);if(!t?.success)return void console.log(dotclear.debug&&t?.message?t.message:"Dotclear REST server error");t?.payload.ret&&t.payload.nb>0&&(s=t.payload.last_id,dotclear.services("dmLastSpamsRows",a=>{try{const s=JSON.parse(a);if(!s?.success)return void console.log(dotclear.debug&&s?.message?s.message:"Dotclear REST server error");if(s?.payload.ret){const{counter:a}=s.payload;for(const e of document.querySelectorAll("#last-spams ul"))e.remove();for(const e of document.querySelectorAll("#last-spams p"))e.remove();a>0&&(dotclear.dmLastSpams.lastCounter=Number(dotclear.dmLastSpams.lastCounter)+a);const t=document.querySelector("#last-spams h3");t?.insertAdjacentHTML("afterend",s.payload.list),dotclear.dmLastSpams.badge&&dotclear.badge(document.querySelector("#last-spams"),{id:"dmls",value:dotclear.dmLastSpams.lastCounter,remove:dotclear.dmLastSpams.lastcounter<=0}),dotclear.expandContent({lines:document.querySelectorAll("#last-spams li.line"),callback:e});for(const e of document.querySelectorAll("#last-spams ul"))e.classList.add("expandable")}}catch(e){console.log(e)}},e=>{console.log(e)},!0,{json:1,stored_id:dotclear.dmLastSpams.lastSpamId,last_id:s,last_counter:dotclear.dmLastSpams.lastCounter}),dotclear.dmLastSpams.lastSpamId=t.payload.last_id)}catch(e){console.log(e)}var s},e=>{console.log(e)},!0,{json:1,last_id:dotclear.dmLastSpams.lastSpamId})};dotclear.expandContent({lines:document.querySelectorAll("#last-spams li.line"),callback:e});for(const e of document.querySelectorAll("#last-spams ul"))e.classList.add("expandable");dotclear.dmLastSpams.autoRefresh&&(s(),dotclear.dmLastSpams.timer=setInterval(s,1e3*(dotclear.dmLastSpams.interval||30)),dotclear.dmLastSpams.badge&&(icon_com=document.querySelector("#dashboard-main #icons p #icon-process-comments-fav"),icon_com&&(a(icon_com),dotclear.dmLastSpams.timerSpam=setInterval(a,1e3*(dotclear.dmLastSpams.interval||30),icon_com))))});
