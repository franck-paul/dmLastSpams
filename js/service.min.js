"use strict";dotclear.dmLastSpamsCount=a=>{dotclear.services("dmLastSpamsCount",(s=>{try{const e=JSON.parse(s);if(!e?.success)return void console.log(dotclear.debug&&e?.message?e.message:"Dotclear REST server error");if(e?.payload.ret){const s=e.payload.nb;void 0!==s&&s!=dotclear.dmLastSpams_SpamCount&&(dotclear.badge(a,{id:"dmls",remove:0==s,value:s,sibling:!0,icon:!0}),dotclear.dmLastSpams_SpamCount=s)}}catch(a){console.log(a)}}),(a=>{console.log(a)}),!0,{json:1})},dotclear.dmLastSpamsRows=a=>{dotclear.services("dmLastSpamsRows",(a=>{try{const s=JSON.parse(a);if(!s?.success)return void console.log(dotclear.debug&&s?.message?s.message:"Dotclear REST server error");if(s?.payload.ret){const a=s.payload.counter;$("#last-spams ul").length&&$("#last-spams ul").remove(),$("#last-spams p").length&&$("#last-spams p").remove(),a>0&&(dotclear.dmLastSpams_LastCounter=Number(dotclear.dmLastSpams_LastCounter)+a),$("#last-spams h3").after(s.payload.list),dotclear.dmLastSpams_Badge&&dotclear.badge($("#last-spams"),{id:"dmls",value:dotclear.dmLastSpams_LastCounter,remove:0==dotclear.dmLastSpams_LastCounter}),$.expandContent({lines:$("#last-spams li.line"),callback:dotclear.dmLastSpamsView}),$("#last-spams ul").addClass("expandable")}}catch(a){console.log(a)}}),(a=>{console.log(a)}),!0,{json:1,stored_id:dotclear.dmLastSpams_LastSpamId,last_id:a,last_counter:dotclear.dmLastSpams_LastCounter})},dotclear.dmLastSpamsCheck=()=>{dotclear.services("dmLastSpamsCheck",(a=>{try{const s=JSON.parse(a);if(!s?.success)return void console.log(dotclear.debug&&s?.message?s.message:"Dotclear REST server error");if(s?.payload.ret){s.payload.nb>0&&(dotclear.dmLastSpamsRows(s.payload.last_id),dotclear.dmLastSpams_LastSpamId=s.payload.last_id)}}catch(a){console.log(a)}}),(a=>{console.log(a)}),!0,{json:1,last_id:dotclear.dmLastSpams_LastSpamId})},dotclear.dmLastSpamsView=(a,s="toggle",e=null)=>{if(null==$(a).attr("id"))return;const t=$(a).attr("id").substr(4),o=`dmlse${t}`;let l=document.getElementById(o);const d=!e.metaKey;l?($(l).toggle(),$(a).toggleClass("expand")):dotclear.getCommentContent(t,(s=>{s?(l=document.createElement("li"),l.id=o,l.className="expand",$(l).append(s),$(a).addClass("expand"),a.parentNode.insertBefore(l,a.nextSibling)):$(a).removeClass("expand")}),{metadata:!1,clean:d})},$((()=>{if(Object.assign(dotclear,dotclear.getData("dm_lastspams")),$.expandContent({lines:$("#last-spams li.line"),callback:dotclear.dmLastSpamsView}),$("#last-spams ul").addClass("expandable"),dotclear.dmLastSpams_AutoRefresh&&(dotclear.dmLastSpamsCheck(),dotclear.dmLastSpams_Timer=setInterval(dotclear.dmLastSpamsCheck,3e4),dotclear.dmLastSpams_Badge)){$("#last-spams").addClass("badgeable");let a=$('#dashboard-main #icons p a[href="comments.php"]');a.length||(a=$("#dashboard-main #icons p #icon-process-comments-fav")),a.length&&(dotclear.dmLastSpamsCount(a),dotclear.dmLastSpams_TimerSpam=setInterval(dotclear.dmLastSpamsCount,3e4,a))}}));
